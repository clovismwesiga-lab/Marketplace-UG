<script type="module">
  import { db } from "./firebase-config.js";
  import { collection, getDocs, orderBy, query } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const itemsBox = document.getElementById("items");
  itemsBox.innerHTML = "<p>Loadingâ€¦</p>";

  async function loadItems() {
    try {
      const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
      const snapshot = await getDocs(q);

      if (snapshot.empty) {
        itemsBox.innerHTML = "<p>No items posted yet.</p>";
        return;
      }

      itemsBox.innerHTML = ""; // clear loading text

      snapshot.forEach(doc => {
        const item = doc.data();
        itemsBox.innerHTML += `
          <div class="item-card">
            <h3>${item.title}</h3>
            <p class="price">UGX ${item.price}</p>
            <p>${item.description}</p>
          </div>
        `;
      });

    } catch (err) {
      itemsBox.innerHTML = "<p>Failed to load items. Check internet.</p>";
      console.error(err);
    }
  }

  loadItems();
</script>
